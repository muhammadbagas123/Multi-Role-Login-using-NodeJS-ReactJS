"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.adminOnly=exports.verifyUser=void 0;var _UserModel=_interopRequireDefault(require("../model/UserModel.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var verifyUser=function(r,n,t){var s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(r.session.userId){e.next=2;break}return e.abrupt("return",n.status(401).json({msg:"Mohon login ke akun Anda!"}));case 2:return e.next=4,regeneratorRuntime.awrap(_UserModel.default.findOne({where:{uuid:r.session.userId}}));case 4:if(s=e.sent){e.next=7;break}return e.abrupt("return",n.status(404).json({msg:"User tidak ditemukan"}));case 7:r.userId=s.id,r.role=s.role,t();case 10:case"end":return e.stop()}})};exports.verifyUser=verifyUser;var adminOnly=function(r,n,t){var s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(_UserModel.default.findOne({where:{uuid:r.session.userId}}));case 2:if(s=e.sent){e.next=5;break}return e.abrupt("return",n.status(404).json({msg:"User tidak ditemukan"}));case 5:if("admin"!==s.role)return e.abrupt("return",n.status(403).json({msg:"Akses terlarang"}));e.next=7;break;case 7:t();case 8:case"end":return e.stop()}})};exports.adminOnly=adminOnly;
//# sourceMappingURL=AuthUser.min.js.map
