"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.logOut=exports.Me=exports.Login=void 0;var _UserModel=_interopRequireDefault(require("../model/UserModel.js")),_argon=_interopRequireDefault(require("argon2"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var Login=function(r,t){var n,s,a,u,o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(_UserModel.default.findOne({where:{email:r.body.email}}));case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return",t.status(404).json({msg:"User tidak ditemukan"}));case 5:return e.next=7,regeneratorRuntime.awrap(_argon.default.verify(n.password,r.body.password));case 7:if(e.sent){e.next=10;break}return e.abrupt("return",t.status(400).json({msg:"Wrong Password"}));case 10:r.session.userId=n.uuid,s=n.uuid,a=n.name,u=n.email,o=n.role,t.status(200).json({uuid:s,name:a,email:u,role:o});case 16:case"end":return e.stop()}})};exports.Login=Login;var Me=function(r,t){var n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(r.session.userId){e.next=2;break}return e.abrupt("return",t.status(401).json({msg:"Mohon login ke akun Anda!"}));case 2:return e.next=4,regeneratorRuntime.awrap(_UserModel.default.findOne({attributes:["uuid","name","email","role"],where:{uuid:r.session.userId}}));case 4:if(n=e.sent){e.next=7;break}return e.abrupt("return",t.status(404).json({msg:"User tidak ditemukan"}));case 7:t.status(200).json(n);case 8:case"end":return e.stop()}})};exports.Me=Me;var logOut=function(e,r){e.session.destroy(function(e){if(e)return r.status(400).json({msg:"Tidak dapat logout"});r.status(200).json({msg:"Anda telah logout"})})};exports.logOut=logOut;
//# sourceMappingURL=Auth.min.js.map
