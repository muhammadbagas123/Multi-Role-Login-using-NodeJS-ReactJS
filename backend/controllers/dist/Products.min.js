"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.deleteProduct=exports.updateProduct=exports.createProduct=exports.getProductById=exports.getProducts=void 0;var _ProductModel=_interopRequireDefault(require("../model/ProductModel.js")),_UserModel=_interopRequireDefault(require("../model/UserModel.js")),_sequelize=require("sequelize");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var getProducts=function(r,t){var a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"admin"===r.role)return e.next=4,regeneratorRuntime.awrap(_ProductModel.default.findAll({attributes:["uuid","name","price"],include:[{model:_UserModel.default,attributes:["name","email"]}]}));e.next=7;break;case 4:a=e.sent,e.next=10;break;case 7:return e.next=9,regeneratorRuntime.awrap(_ProductModel.default.findAll({attributes:["uuid","name","price"],where:{userId:r.userId},include:[{model:_UserModel.default,attributes:["name","email"]}]}));case 9:a=e.sent;case 10:t.status(200).json(a),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),t.status(500).json({msg:e.t0.message});case 16:case"end":return e.stop()}},null,null,[[0,13]])};exports.getProducts=getProducts;var getProductById=function(r,t){var a,u;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(_ProductModel.default.findOne({where:{uuid:r.params.id}}));case 3:if(a=e.sent){e.next=6;break}return e.abrupt("return",t.status(404).json({msg:"Data tidak ditemukan"}));case 6:if("admin"===r.role)return e.next=9,regeneratorRuntime.awrap(_ProductModel.default.findOne({attributes:["uuid","name","price"],where:{id:a.id},include:[{model:_UserModel.default,attributes:["name","email"]}]}));e.next=12;break;case 9:u=e.sent,e.next=15;break;case 12:return e.next=14,regeneratorRuntime.awrap(_ProductModel.default.findOne({attributes:["uuid","name","price"],where:_defineProperty({},_sequelize.Op.and,[{id:a.id},{userId:r.userId}]),include:[{model:_UserModel.default,attributes:["name","email"]}]}));case 14:u=e.sent;case 15:t.status(200).json(u),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),t.status(500).json({msg:e.t0.message});case 21:case"end":return e.stop()}},null,null,[[0,18]])};exports.getProductById=getProductById;var createProduct=function(r,t){var a,u,n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.body,u=a.name,n=a.price,e.prev=1,e.next=4,regeneratorRuntime.awrap(_ProductModel.default.create({name:u,price:n,userId:r.userId}));case 4:t.status(201).json({msg:"Product Created Successfuly"}),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),t.status(500).json({msg:e.t0.message});case 10:case"end":return e.stop()}},null,null,[[1,7]])};exports.createProduct=createProduct;var updateProduct=function(r,t){var a,u,n,s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(_ProductModel.default.findOne({where:{uuid:r.params.id}}));case 3:if(a=e.sent){e.next=6;break}return e.abrupt("return",t.status(404).json({msg:"Data tidak ditemukan"}));case 6:if(u=r.body,n=u.name,s=u.price,"admin"===r.role)return e.next=10,regeneratorRuntime.awrap(_ProductModel.default.update({name:n,price:s},{where:{id:a.id}}));e.next=12;break;case 10:e.next=16;break;case 12:if(r.userId!==a.userId)return e.abrupt("return",t.status(403).json({msg:"Akses terlarang"}));e.next=14;break;case 14:return e.next=16,regeneratorRuntime.awrap(_ProductModel.default.update({name:n,price:s},{where:_defineProperty({},_sequelize.Op.and,[{id:a.id},{userId:r.userId}])}));case 16:t.status(200).json({msg:"Product updated successfuly"}),e.next=22;break;case 19:e.prev=19,e.t0=e.catch(0),t.status(500).json({msg:e.t0.message});case 22:case"end":return e.stop()}},null,null,[[0,19]])};exports.updateProduct=updateProduct;var deleteProduct=function(r,t){var a,u;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(_ProductModel.default.findOne({where:{uuid:r.params.id}}));case 3:if(a=e.sent){e.next=6;break}return e.abrupt("return",t.status(404).json({msg:"Data tidak ditemukan"}));case 6:if(u=r.body,u.name,u.price,"admin"===r.role)return e.next=10,regeneratorRuntime.awrap(_ProductModel.default.destroy({where:{id:a.id}}));e.next=12;break;case 10:e.next=16;break;case 12:if(r.userId!==a.userId)return e.abrupt("return",t.status(403).json({msg:"Akses terlarang"}));e.next=14;break;case 14:return e.next=16,regeneratorRuntime.awrap(_ProductModel.default.destroy({where:_defineProperty({},_sequelize.Op.and,[{id:a.id},{userId:r.userId}])}));case 16:t.status(200).json({msg:"Product deleted successfuly"}),e.next=22;break;case 19:e.prev=19,e.t0=e.catch(0),t.status(500).json({msg:e.t0.message});case 22:case"end":return e.stop()}},null,null,[[0,19]])};exports.deleteProduct=deleteProduct;
//# sourceMappingURL=Products.min.js.map
